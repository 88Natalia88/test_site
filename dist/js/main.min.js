window.addEventListener("DOMContentLoaded",(()=>{getProducts(),startCountdown()}));const items=document.querySelectorAll(".proposal__item"),modalItems=document.querySelector(".modal__popup-items"),closeBtn=document.querySelector(".modal__popup-close"),modal=document.querySelector(".modal");async function getProducts(){const e=await fetch("https://t-pay.iqfit.app/subscribe/list-test"),t=await e.json(),o=t.filter((e=>!0===e.isPopular)),n=t.filter((e=>!0===e.isDiscount)),s=t.filter((e=>!1===e.isDiscount&&!1===e.isPopular)).map((e=>e.price));renderOffer(n,s),renderProducts(o,s)}let timerInterval,countdown=40,minute=document.getElementById("minute"),second=document.getElementById("second");function startCountdown(){timerInterval=setInterval(updateCountdown,1e3)}function updateCountdown(){if(countdown--,countdown<0)return clearInterval(timerInterval),getNewPrice(),void displayModal();const e=Math.floor(countdown/60),t=countdown%60;minute.innerText=formatTime(e),second.innerText=formatTime(t),countdown<=30&&(minute.style.color="#FD4D35",second.style.color="#FD4D35",document.querySelector(".header__tods").style.color="#FD4D35",minute.classList.add("blink"),second.classList.add("blink"))}function formatTime(e){return e<10?`0${e}`:e}function calculatePercentChange(e,t){const o=(e-t)/e*100;return 10*Math.round(o/10)}function renderOffer(e,t){e.forEach(((o,n)=>{const s=calculatePercentChange(t[n],o.price);if(o){const a=document.createElement("div");a.className="modal__popup-item",a.innerHTML+=`\n                <div class='modal__item-header'>\n                    <p class="modal__item-name">${o.name}</p>\n                    <label class="modal__castom-radio">\n                        <input type="radio" name="radio-button" class="modal__popup-radio">\n                        <span class="modal__castom-icon"></span>\n                    </label>\n                </div>\n                <p class="modal__item-oldPrice">${t[n]}&#8381;</p>\n                <div class='modal__item-info'>\n                    <p class='modal__item-price'>${o.price}&#8381;</p>\n                    <div class="modal__item-sale">\n                        <img src='icons/Star.svg' alt="star" class='modal__item-star'>\n                        <p class='modal__item-percent ${n===e.length-1?"modal__item-percent_last":""}'>-${s}%</p>\n                    </div>\n                </div>\n            `,modalItems.append(a);const l=document.querySelectorAll(".modal__popup-item");l.forEach((e=>{const t=e.querySelector(".modal__popup-radio");e.addEventListener("click",(()=>{t.checked=!0,l.forEach((t=>{t!==e&&(t.style.cssText="")})),e.style.cssText="border: 2px solid rgb(1, 185, 197); background: rgba(1, 185, 197, 0.05);"}))}))}}))}function displayModal(){modal.style.display="block"}function renderProducts(e,t){document.querySelectorAll(".proposal__item").forEach(((o,n)=>{const s=e[n],a=calculatePercentChange(t[n],s.price);if(s){const e=`\n                <div class="proposal__item-sale">\n                    <img src='icons/Star.svg' alt="star" class='proposal__item-star'>\n                    <p class='proposal__item-percent'>-${a}%</p>\n                </div>\n                <s class='proposal__item-oldPrice'>${t[n]}&#8381;</s>\n                <p class="proposal__item-name">${s.name}</p>\n                <p class='proposal__item-price'>${s.price}&#8381;</p>\n            `;o.innerHTML+=e}}))}function getNewPrice(){document.querySelectorAll(".proposal__item-sale").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".proposal__item-price").forEach((e=>{e.style.display="none"}));const e=document.querySelectorAll(".proposal__item-oldPrice");e.forEach(((t,o)=>{o===e.length-1?t.classList.add("proposal__item-oldPrice_last"):t.classList.add("proposal__item-oldPrice_new")}))}closeBtn.addEventListener("click",(()=>{modal.style.display="none"})),items.forEach((e=>{e.addEventListener("click",(()=>{items.forEach((t=>{t!==e&&(t.style.cssText="")})),e.style.cssText="border: 2px solid rgb(1, 185, 197); background: rgba(1, 185, 197, 0.05);"}))}));